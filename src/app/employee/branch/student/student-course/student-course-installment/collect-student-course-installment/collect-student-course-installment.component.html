<nb-card *ngIf="!loading">
  <nb-card-header>
    <button
      type="button"
      class="float-right"
      nbButton
      size="small"
      status="warning"
      (click)="back()"
    >
      Back
    </button>
    <h3 class="">
      Collect Installment
    </h3>
  </nb-card-header>
  <nb-card-body>
    <nb-stepper #stepper [linear]="true" [disableStepNavigation]="true">
      <nb-step [stepControl]="courseInstallmentReceiptForm" label="Receipt Details">
        <form
          class=""
          (submit)="courseInstallmentReceiptFormSubmit()"
          [formGroup]="courseInstallmentReceiptForm"
        >
          <div class="row">
            <div class="col-md-6">
              <div class="form-control-group">
                <label class="label" for="input-generatedBy">Generated By:</label>
                <input
                  type="text"
                  nbInput
                  id="input-generatedBy"
                  name="generatedBy"
                  formControlName="generatedBy"
                  placeholder="Generated By"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('generatedBy').touched
                      ? courseInstallmentReceiptForm.get('generatedBy').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('generatedBy').invalid &&
                    courseInstallmentReceiptForm.get('generatedBy').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('generatedBy').errors?.required"
                  >
                    Generated By is required!
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-control-group">
                <label class="label" for="input-date">Installment Date:</label>
                <input
                  type="date"
                  nbInput
                  id="input-date"
                  name="date"
                  formControlName="date"
                  placeholder="Date"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('date').touched
                      ? courseInstallmentReceiptForm.get('date').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  disabled="true"
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('date').invalid &&
                    courseInstallmentReceiptForm.get('date').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('date').errors?.required"
                  >
                    Installment Date is required!
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-control-group">
                <label class="label" for="input-amount">Installment Amount:</label>
                <input
                  type="number"
                  nbInput
                  id="input-amount"
                  name="amount"
                  min="0"
                  formControlName="amount"
                  placeholder="amount"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('amount').touched
                      ? courseInstallmentReceiptForm.get('amount').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  disabled="true"
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('amount').invalid &&
                    courseInstallmentReceiptForm.get('amount').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('amount').errors?.required"
                  >
                    Installment Amount is required!
                  </p>
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('amount').errors?.min"
                  >
                    Minimum Installment Amount should be 0
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-control-group">
                <label class="label" for="input-lateFee">Late Fee:</label>
                <input
                  type="number"
                  nbInput
                  id="input-lateFee"
                  name="lateFee"
                  min="0"
                  formControlName="lateFee"
                  placeholder="lateFee"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('lateFee').touched
                      ? courseInstallmentReceiptForm.get('lateFee').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  (input)="calculateTotalAmount()"
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('lateFee').invalid &&
                    courseInstallmentReceiptForm.get('lateFee').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('lateFee').errors?.min"
                  >
                    Minimum late fee Amount should be 0.
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-control-group">
                <label class="label" for="input-totalAmount">Total Fee:</label>
                <input
                  type="number"
                  nbInput
                  id="input-totalAmount"
                  name="totalAmount"
                  min="0"
                  formControlName="totalAmount"
                  placeholder="totalAmount"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('totalAmount').touched
                      ? courseInstallmentReceiptForm.get('totalAmount').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  disabled="true"
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('totalAmount').invalid &&
                    courseInstallmentReceiptForm.get('totalAmount').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('totalAmount').errors?.required"
                  >
                    Total Amount is Required!
                  </p>
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('totalAmount').errors?.min"
                  >
                    Minimum late fee Amount should be 0.
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-control-group">
                <label class="label" for="input-amountDue">Pending Amount:</label>
                <input
                  type="number"
                  nbInput
                  id="input-amountDue"
                  name="amountDue"
                  min="0"
                  formControlName="amountDue"
                  placeholder="Amount Due"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('amountDue').touched
                      ? courseInstallmentReceiptForm.get('amountDue').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                  disabled="true"
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('amountDue').invalid &&
                    courseInstallmentReceiptForm.get('amountDue').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('amountDue').errors?.required"
                  >
                    Pending Amount is Required!
                  </p>
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('amountDue').errors?.min"
                  >
                    Minimum Pending Amount should be 0.
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-control-group">
                <label class="label" for="input-paymentDate">Payment Date:</label>
                <input
                  type="date"
                  nbInput
                  id="input-paymentDate"
                  name="paymentDate"
                  formControlName="paymentDate"
                  placeholder="Payment Date"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('paymentDate').touched
                      ? courseInstallmentReceiptForm.get('paymentDate').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('paymentDate').touched &&
                    courseInstallmentReceiptForm.get('paymentDate').invalid
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('paymentDate').errors?.required"
                  >
                    Payment date is required!
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-control-group">
                <label class="label" for="input-paymentMode">Payment Mode:</label>
                <nb-select
                  id="input-paymentMode"
                  name="paymentMode"
                  formControlName="paymentMode"
                  placeholder="paymentMode"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('paymentMode').touched
                      ? courseInstallmentReceiptForm.get('paymentMode').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                >
                  <nb-option value="">Select Payment Mode</nb-option>
                  <nb-option value="cash">Cash</nb-option>
                  <nb-option value="card">Card</nb-option>
                  <nb-option value="wallet">Waller</nb-option>
                  <nb-option value="online">Online</nb-option>
                  <nb-option value="other">Other</nb-option>
                </nb-select>
              </div>
              <ng-container
                *ngIf="
                  courseInstallmentReceiptForm.get('paymentMode').touched &&
                  courseInstallmentReceiptForm.get('paymentMode').invalid
                "
              >
                <p
                  class="caption status-danger"
                  *ngIf="courseInstallmentReceiptForm.get('paymentMode').errors?.required"
                >
                  Payment Mode is required!
                </p>
              </ng-container>
            </div>

            <div class="col-md-6">
              <div class="form-control-group">
                <label class="label" for="input-bankDetails">Bank Details:</label>
                <input
                  type="text"
                  nbInput
                  id="input-bankDetails"
                  name="bankDetails"
                  formControlName="bankDetails"
                  placeholder="Bank Details"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('bankDetails').touched
                      ? courseInstallmentReceiptForm.get('bankDetails').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('bankDetails').invalid &&
                    courseInstallmentReceiptForm.get('bankDetails').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('bankDetails').errors?.required"
                  >
                    Bank Details are required!
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-control-group">
                <label class="label" for="input-transactionDetails">Transaction Details:</label>
                <input
                  type="text"
                  nbInput
                  id="input-transactionDetails"
                  name="transactionDetails"
                  formControlName="transactionDetails"
                  placeholder="Transaction Details"
                  fullWidth
                  [status]="
                    courseInstallmentReceiptForm.get('transactionDetails').touched
                      ? courseInstallmentReceiptForm.get('transactionDetails').invalid
                        ? 'danger'
                        : 'success'
                      : 'basic'
                  "
                />
                <ng-container
                  *ngIf="
                    courseInstallmentReceiptForm.get('transactionDetails').invalid &&
                    courseInstallmentReceiptForm.get('transactionDetails').touched
                  "
                >
                  <p
                    class="caption status-danger"
                    *ngIf="courseInstallmentReceiptForm.get('transactionDetails').errors?.required"
                  >
                    Transaction Details are required!
                  </p>
                </ng-container>
              </div>
            </div>

            <div class="col-md-12">
              <div class="form-control-group">
                <label class="label" for="input-description">Description:</label>
                <textarea
                  type="text"
                  nbInput
                  rows="2"
                  id="input-description"
                  name="description"
                  formControlName="description"
                  placeholder="Description (Optional)"
                  fullWidth
                ></textarea>
              </div>
            </div>
          </div>

          <hr />

          <div class="row">
            <div class="col-md-12 text-right">
              <button nbButton size="small" type="submit">
                <span>Next</span>
                <nb-icon icon="arrow-ios-forward-outline"></nb-icon>
              </button>
            </div>
          </div>
        </form>
      </nb-step>

      <nb-step label="Submit">
        <div class="step-container">
          <div class="table-responsive">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <th>Course</th>
                  <td>{{ getCourseName(courseId) | async }}</td>
                </tr>

                <tr>
                  <th>Generated By</th>
                  <td>{{ courseInstallmentReceiptForm.value.generatedBy }}</td>
                </tr>
                <tr>
                  <th>Installment Date</th>
                  <td>{{ dateService.formatDate(courseInstallmentReceiptForm.value.date) }}</td>
                </tr>
                <tr>
                  <th>Installment Amount</th>
                  <td>
                    {{ courseInstallmentReceiptForm.value.amount }}
                  </td>
                </tr>
                <tr>
                  <th>Late Fee</th>
                  <td>{{ courseInstallmentReceiptForm.value.lateFee }}</td>
                </tr>
                <tr>
                  <th>Total Amount</th>
                  <td>{{ courseInstallmentReceiptForm.value.totalAmount }}</td>
                </tr>
                <tr>
                  <th>Payment Date</th>
                  <td>
                    {{ dateService.formatDate(courseInstallmentReceiptForm.value.paymentDate) }}
                  </td>
                </tr>

                <tr>
                  <th>Payment Mode</th>
                  <td>{{ courseInstallmentReceiptForm.value.paymentMode | uppercase }}</td>
                </tr>
                <tr>
                  <th>Bank Details</th>
                  <td>{{ courseInstallmentReceiptForm.value.bankDetails }}</td>
                </tr>
                <tr>
                  <th>Transaction Details</th>
                  <td>{{ courseInstallmentReceiptForm.value.transactionDetails }}</td>
                </tr>
                <tr>
                  <th>description</th>
                  <td>{{ courseInstallmentReceiptForm.value.description }}</td>
                </tr>
                <tr>
                  <th>Pending Amount</th>
                  <td>{{ courseInstallmentReceiptForm.value.amountDue }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <hr />

          <div class="row">
            <div class="col-md-6 text-left">
              <button type="button" class="" nbButton size="small" (click)="previousStep()">
                <nb-icon icon="arrow-ios-back-outline"></nb-icon>
                <span>prev</span>
              </button>
            </div>
            <div class="col-md-6 text-right">
              <button nbButton size="small" type="button" (click)="saveCourseInstallmentReceipt()">
                <span>Submit</span>
              </button>
            </div>
          </div>
        </div>
      </nb-step>
    </nb-stepper>
  </nb-card-body>
</nb-card>
